
<% content_for :head_maps do %>
    <!-- Script for loading Google Maps API -->
    <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
    <!-- Script for loading Marker Cluster -->
    <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
    <!-- Script for loading Rich Marker-->
    <script src='//google-maps-utility-library-v3.googlecode.com/svn/trunk/richmarker/src/richmarker-compiled.js' type='text/javascript'></script>
    <!-- Script for loading Infobox -->
    <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script>
<% end %>

<!-- Lead - Image, title and buttons -->
<div class='jumbotron'>

  <div class='container-fluid'>
    <!-- milion stories logo -->
    <p class='text-center text-lowercase'><small>milion stories</small></p>
    <!-- title image -->
    <%= image_tag(story.header_image, class: 'img-responsive', alt: 'Title image') %>
    <!-- lead title -->
    <h1 class='text-center text-uppercase'><%= story.name %></h1>

    <!-- navigation buttons for article -->
    <div class='col-md-8 col-md-offset-2'>
      <div class='row'>
        <div class='col-md-3'>
          <a class='btn btn-default btn-block text-lowercase' href='#story_section' role=''>story</a>
        </div>
        <div class='col-md-3'>
          <a class='btn btn-default btn-block text-lowercase' href='#pictures_section' role='button'>pictures</a>
        </div>
        <div class='col-md-3'>
          <a class='btn btn-default btn-block text-lowercase' href='#advice_section' role='button'>advice</a>
        </div>
        <div class='col-md-3'>
          <a class='btn btn-default btn-block text-lowercase' href='#map_section' role='button'>map</a>
        </div>
      </div>
    </div>

    <% if user_signed_in? %>
      <!-- admin buttons for story -->
      <div class='col-md-8 col-md-offset-2'>
        <br>
        <div class='row'>
          <div class='col-md-4'>
            <%= link_to(edit_story_path(story)) do %>
            <button class='btn btn-default btn-block' role='button'>Edit Story</button>
            <% end %>
          </div>
          <div class='col-md-4'>
            <%= link_to(edit_pictures_path(story)) do %>
            <button class='btn btn-default btn-block' role='button'>Manage Pictures of Story</button>
            <% end %>
          </div>
          <div class='col-md-2 col-md-offset-2'>
            <%= link_to(story, method: :delete, data: { confirm: 'Are you sure you want to delete it? All elements related to story will be deleted as well.' }) do %>
            <button class='btn btn-default btn-block' role='button'>Delete Story</button>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

  </div>

</div>
<!-- /jumbotron -->

<!-- Main column and side menu -->
<div class='container-fluid'>
  <!-- Main column -->
  <div class='col-md-10'>

    <!-- name of section - Story -->
    <div>
      <h1 class='text-center text-uppercase' id="story_section">story</h1>
      <!-- date -->
      <p class='text-center text-lowercase'><small><%= story.created_at.strftime("%e.%m.%Y") %></small></p>

      <!-- Story - Chapters -->
      <% story.chapters.each do |chapter| %>
          <!-- Story text -->
          <div>
            <p><%= chapter.text %></p>
          </div>
          <!-- Pictures for story -->
        <div class='row'>
          <% chapter.pictures.each do |picture| %>
            <div class='col-md-4'>
              <%= image_tag(picture.link,  class: 'img-responsive', alt: 'Title image') %>
              <% if user_signed_in? %>
                <br>
                <div class="row">
                  <div class="col-md-5 col-md-offset-1">
                    <%= link_to(edit_picture_path(picture)) do %>
                      <button class='btn btn-default btn-block' role='button'>Edit Picture</button>
                    <% end %>
                  </div>
                  <div class="col-md-5 ">
                    <%= link_to(picture, method: :delete, data: { confirm: 'Are you sure you want to delete it?' }) do %>
                      <button class='btn btn-default btn-block' role='button'>Delete Picture</button>
                    <% end %>
                  </div>
                </div>
                <hr/>
              <% end %>
            </div>
          <% end %>
        </div>
        <% if user_signed_in? %>
          <br>
          <div class="row">
            <div class="col-md-4 col-md-offset-4">
              <%= link_to(edit_story_chapter_path(story, chapter)) do %>
                <button class='btn btn-default btn-block' role='button'>Edit Chapter</button>
              <% end %>
            </div>
            <div class="col-md-2 col-md-offset-2">
              <%= link_to(chapter, method: :delete, data: { confirm: 'Are you sure you want to delete it?' }) do %>
                <button class='btn btn-default btn-block' role='button'>Delete Chapter</button>
              <% end %>
            </div>
          </div>
          <hr/>
          <br>
        <% end %>
    <% end %>

      <% if user_signed_in? %>
        <!-- Form for adding chapter -->
        <div class="panel panel-default panel-info">
          <div class="panel-heading"><h3 class='text-center text-uppercase'>Add new Chapter</h3></div>
          <div class="panel-body">
          <%= simple_form_for [story, chapter] do |f| %>
            <%= f.input :text, as: :text %>
            <div class="col-md-12">
              <h3 class='text-center'>Add new pictures to Chapter</h3>
              <div class="row">
              <%= f.simple_fields_for :pictures do |picture_form| %>

                  <div class="col-md-4">
                    <div class="panel panel-default panel-body">
                    <%= picture_form.input :title, label: 'Title of picture', placeholder: 'View over city.', hint: 'Field above must be filled.' %>
                    <%= picture_form.input :link, label: 'Link to picture on server', placeholder: 'www.example.com', hint: 'Field above must be filled.' %>
                    <%= picture_form.input :story_id, label: 'Story, to which picture is linked', placeholder: '1', hint: 'Value is visible in URL field.' %>
                    <%= picture_form.input :location, label: 'Name of place where picture was taken', placeholder: 'London, UK' %>
                    <%= picture_form.input :latitude, hint: 'Put only numbers and comas.', placeholder: 'data for google maps' %>
                    <%= picture_form.input :longitude, hint: 'Put only numbers and comas.',placeholder: 'data for google maps' %>

                    </div>
                  </div>

              <% end %>
              </div>
            <%= f.button :submit, 'Add Chapter with pictures', class: 'btn btn-default btn-block btn-info' %>
            </div>
          <% end %>
          </div>
        </div>
    <% end %>

      <!-- Social media items -->
      <%= render 'socialmedia_icons' %>
      <!-- /Social media items -->
    </div>
    <!-- /name of section - Story -->

    <!-- name of section - Pictures -->
    <div>
      <h1 class='text-center text-uppercase' id="pictures_section" >pictures</h1>
      <!-- date -->
      <p class='text-center text-lowercase'><small><%= story.updated_at.strftime("%e.%m.%Y") %></small></p>

      <div class='row'>
        <% story.pictures.each do |picture| %>
            <div class='col-md-4'>
              <%= link_in_image(picture.link, story_pictures_path(story), {class: 'img-responsive img-thumbnail', alt:""}) %>
            </div>
        <% end %>
      </div>

      <!-- Social media items -->
      <%= render 'socialmedia_icons' %>
      <!-- /Social media items -->
    </div>
    <!-- /name of section - Pictures -->

    <!-- name of section - Map -->
    <div data-no-turbolink>
      <h1 class='text-center text-uppercase' id="map_section">map</h1>
      <!-- date -->
      <p class='text-center text-lowercase'><small><%= story.updated_at.strftime("%e.%m.%Y") %></small></p>

      <%= render 'showstory_maps' %>

      <!-- Social media items -->
      <%= render 'socialmedia_icons' %>
      <!-- /Social media items -->
    </div>
    <!-- /name of section - Map -->

    <!-- name of section - Advice -->
    <div>
      <h1 class='text-center text-uppercase' id="advice_section">advice</h1>
      <!-- date -->
      <p class='text-center text-lowercase'><small><%= story.updated_at.strftime("%e.%m.%Y") %></small></p>

      <!-- Story - Advice -->
      <% story.advices.each do |advice| %>
          <!-- Story text -->
          <div>
            <p><%= advice.text %></p>
          </div>

          <!-- Pictures for story -->
          <div class='row'>
            <% advice.pictures.each do |picture| %>
                <div class='col-md-4'>
                  <%= image_tag(picture.link,  class: 'img-responsive', alt: 'Title image') %>
                  <% if user_signed_in? %>
                    <br>
                    <div class="row">
                      <div class="col-md-5 col-md-offset-1">
                        <%= link_to(edit_picture_path(picture)) do %>
                          <button class='btn btn-default btn-block' role='button'>Edit Picture</button>
                        <% end %>
                      </div>
                      <div class="col-md-5 ">
                        <%= link_to(picture, method: :delete, data: { confirm: 'Are you sure you want to delete it?' }) do %>
                          <button class='btn btn-default btn-block' role='button'>Delete Picture</button>
                        <% end %>
                      </div>
                    </div>
                    <hr/>
                  <% end %>
                </div>
            <% end %>
          </div>
          <% if user_signed_in? %>
            <br>
            <div class="row">
              <div class="col-md-4 col-md-offset-4">
                <%= link_to(edit_story_advice_path(story, advice)) do %>
                  <button class='btn btn-default btn-block' role='button'>Edit Advice</button>
                <% end %>
              </div>
              <div class="col-md-2 col-md-offset-2">
                <%= link_to(advice, method: :delete, data: { confirm: 'Are you sure you want to delete it?' }) do %>
                  <button class='btn btn-default btn-block' role='button'>Delete Advice</button>
                <% end %>
              </div>
            </div>
            <hr/>
            <br>
          <% end %>
      <% end %>

      <% if user_signed_in? %>
        <!-- Form for adding advice -->
        <div class="panel panel-default panel-info">
          <div class="panel-heading"><h3 class='text-center text-uppercase'>Add new Advice</h3></div>
          <div class="panel-body">
          <%= simple_form_for [story, advice] do |f| %>
            <%= f.input :text, as: :text %>
            <div class="col-md-12">
              <h3 class='text-center'>Add new pictures to Advice</h3>
              <div class="row">
                <%= f.fields_for :pictures do |picture_form| %>

                  <div class="col-md-4">
                    <div class="panel panel-default panel-body">
                      <%= picture_form.input :title, label: 'Title of picture', placeholder: 'View over city.', hint: 'Field above must be filled.' %>
                      <%= picture_form.input :link, label: 'Link to picture on server', placeholder: 'www.example.com', hint: 'Field above must be filled.' %>
                      <%= picture_form.input :story_id, label: 'Story, to which picture is linked', placeholder: '1', hint: 'Value is visible in URL field.' %>
                      <%= picture_form.input :location, label: 'Name of place where picture was taken', placeholder: 'London, UK' %>
                      <%= picture_form.input :latitude, hint: 'Put only numbers and comas.', placeholder: 'data for google maps' %>
                      <%= picture_form.input :longitude, hint: 'Put only numbers and comas.',placeholder: 'data for google maps' %>
                    </div>
                  </div>

                <% end %>
              </div>
            <%= f.button :submit, 'Add Advice with pictures', class: 'btn btn-default btn-block btn-info' %>
            </div>
          <% end %>
          </div>
        </div>
      <% end %>

      <!-- Social media items -->
      <%= render 'socialmedia_icons' %>
      <!-- /Social media items -->
    </div>

    <!-- /name of section - Advice -->

  </div>
  <!-- /Main column -->

  <!-- Right Column - Menu -->
  <%= render 'shared/rightmenu' %>
  <!-- /Right Column - Menu -->

</div>

<% content_for :footer_maps do %>
    <!-- Loading data to Google maps from controller, through 'buildMap', to coffeescript file -->
    <script type="text/javascript">
        // variable buildMap - stored in stories.coffee
        buildMap(<%= raw @hash.to_json %>);
    </script>
<% end %>